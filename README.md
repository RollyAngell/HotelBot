# üè® Bot de Registro de Clientes para Hotel

Bot de Telegram para registro de clientes de hotel con OCR, integraci√≥n con Google Sheets y Google Drive.

## üöÄ Caracter√≠sticas

- **OCR autom√°tico**: Extracci√≥n de datos de DNI usando Google Cloud Vision API
- **Formulario conversacional**: Gu√≠a paso a paso para registrar clientes
- **Google Sheets**: Almacenamiento autom√°tico de registros
- **Google Drive**: Backup seguro de fotos de DNI
- **Seguridad**: Acceso restringido solo a personal autorizado
- **Informes**: Resumen diario y disponibilidad de habitaciones
- **Multiusuario**: Soporte para m√∫ltiples usuarios del hotel

## üìã Requisitos

- Python 3.8+
- Cuenta de Google Cloud con APIs habilitadas
- Bot de Telegram creado con BotFather
- Google Sheets y Google Drive configurados

## üì¶ Instalaci√≥n

### 1. Clonar el repositorio

```bash
git clone <tu-repositorio>
cd HotelBot
```

### 2. Instalar dependencias

```bash
pip install -r requirements.txt
```

### 3. Configurar Google Cloud

#### Habilitar APIs
1. Ve a [Google Cloud Console](https://console.cloud.google.com/)
2. Crea un nuevo proyecto o selecciona uno existente
3. Habilita las siguientes APIs:
   - Google Cloud Vision API
   - Google Sheets API
   - Google Drive API

#### Crear credenciales
1. Ve a **IAM & Admin** > **Service Accounts**
2. Crea una nueva cuenta de servicio
3. Descarga el archivo JSON de credenciales
4. Guarda el archivo en `credentials/hotel-bot-credentials.json`

### 4. Configurar Google Sheets

1. Crea una nueva hoja de c√°lculo en Google Sheets
2. Comparte la hoja con el email de la cuenta de servicio
3. Copia el ID de la hoja de c√°lculo desde la URL

### 5. Configurar Google Drive

1. Crea una carpeta en Google Drive para las fotos
2. Comparte la carpeta con el email de la cuenta de servicio
3. Copia el ID de la carpeta desde la URL

### 6. Configurar el Bot de Telegram

1. Habla con [@BotFather](https://t.me/BotFather) en Telegram
2. Crea un nuevo bot con `/newbot`
3. Guarda el token del bot

### 7. Configurar variables de entorno

1. Copia el archivo de ejemplo:
   ```bash
   cp config_example.env .env
   ```

2. Edita el archivo `.env` con tus datos:
   ```env
   TELEGRAM_BOT_TOKEN=tu_token_aqui
   TELEGRAM_ADMIN_CHAT_ID=tu_chat_id
   AUTHORIZED_USERS=user1,user2,user3
   GOOGLE_APPLICATION_CREDENTIALS=credentials/hotel-bot-credentials.json
   GOOGLE_SHEETS_SPREADSHEET_ID=tu_spreadsheet_id
   GOOGLE_SHEETS_WORKSHEET_NAME=Registros
   GOOGLE_DRIVE_FOLDER_ID=tu_folder_id
   TIMEZONE=America/Lima
   ```

## üîß Configuraci√≥n Detallada

### Obtener Chat ID

Para obtener tu Chat ID:
1. Env√≠a un mensaje a tu bot
2. Ve a: `https://api.telegram.org/bot<TU_TOKEN>/getUpdates`
3. Busca tu `chat_id` en la respuesta

### Configurar usuarios autorizados

En el archivo `.env`, agrega los Chat IDs de los usuarios autorizados:
```env
AUTHORIZED_USERS=123456789,987654321,555666777
```

### Estructura de Google Sheets

El bot crear√° autom√°ticamente los siguientes encabezados:
- Fecha
- Hora Ingreso
- Hora Salida Estimada
- Habitaci√≥n
- DNI
- Nombre
- Nacionalidad
- Duraci√≥n
- Precio
- Forma de Pago
- Observaciones
- Registrado por

## üöÄ Uso

### Ejecutar el bot

```bash
python hotel_bot.py
```

### Comandos disponibles

- `/start` - Iniciar el bot
- `/nuevo` - Registrar nuevo cliente
- `/resumen` - Ver resumen del d√≠a
- `/habitaciones` - Ver disponibilidad de habitaciones
- `/ayuda` - Obtener ayuda

### Flujo de registro

1. **Enviar foto del DNI**: El usuario env√≠a una foto del DNI del cliente
2. **OCR autom√°tico**: El bot extrae los datos autom√°ticamente
3. **Verificar datos**: El usuario verifica y edita si es necesario
4. **Completar informaci√≥n**: El bot pregunta:
   - Duraci√≥n de estancia
   - Precio cobrado
   - Forma de pago
   - Habitaci√≥n
   - Observaciones
5. **Confirmar y guardar**: Los datos se guardan en Google Sheets y la foto en Google Drive

## üß™ Gu√≠a de Pruebas

### Pasos para Probar el Bot

#### 1. **Configurar Google Cloud** üåê

1. **Ir a Google Cloud Console**:
   - Visita: https://console.cloud.google.com/
   - Crea un nuevo proyecto o selecciona uno existente

2. **Habilitar APIs necesarias**:
   - Ve a "APIs & Services" > "Library"
   - Busca y habilita:
     - Google Cloud Vision API
     - Google Sheets API
     - Google Drive API

3. **Crear cuenta de servicio**:
   - Ve a "IAM & Admin" > "Service Accounts"
   - Clic en "Create Service Account"
   - Nombre: `hotel-bot-service`
   - Rol: `Editor`
   - Clic en "Create Key" > JSON
   - Descargar el archivo JSON

4. **Guardar credenciales**:
   - Renombrar el archivo descargado como `hotel-bot-credentials.json`
   - Copiarlo en la carpeta `credentials/`

#### 2. **Crear Bot en Telegram** ü§ñ

1. **Hablar con BotFather**:
   - Buscar `@BotFather` en Telegram
   - Enviar `/newbot`
   - Elegir nombre: `Hotel Registration Bot`
   - Elegir username: `tu_hotel_bot`

2. **Guardar token**:
   - Copiar el token que te da BotFather
   - Formato: `1234567890:ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefg`

3. **Obtener tu Chat ID**:
   - Enviar un mensaje a tu bot
   - Visitar: `https://api.telegram.org/bot<TU_TOKEN>/getUpdates`
   - Copiar tu `chat_id` de la respuesta

#### 3. **Configurar Google Sheets** üìä

1. **Crear hoja de c√°lculo**:
   - Ir a Google Sheets
   - Crear nueva hoja: "Registros Hotel"
   - Copiar el ID de la URL (parte larga entre /d/ y /edit)

2. **Compartir con el bot**:
   - Clic en "Compartir"
   - Agregar el email de la cuenta de servicio (del archivo JSON)
   - Dar permisos de "Editor"

#### 4. **Configurar Google Drive** üìÅ

1. **Crear carpeta**:
   - Ir a Google Drive
   - Crear nueva carpeta: "Fotos DNI Hotel"
   - Copiar el ID de la URL (parte final despu√©s de /folders/)

2. **Compartir carpeta**:
   - Clic derecho > "Compartir"
   - Agregar el email de la cuenta de servicio
   - Dar permisos de "Editor"

#### 5. **Configurar Variables de Entorno** ‚öôÔ∏è

1. **Crear archivo .env**:
   ```bash
   cp config_example.env .env
   ```

2. **Editar archivo .env** con tus datos:
   ```env
   TELEGRAM_BOT_TOKEN=tu_token_del_bot
   TELEGRAM_ADMIN_CHAT_ID=tu_chat_id
   AUTHORIZED_USERS=tu_chat_id,otro_chat_id
   GOOGLE_APPLICATION_CREDENTIALS=credentials/hotel-bot-credentials.json
   GOOGLE_SHEETS_SPREADSHEET_ID=tu_spreadsheet_id
   GOOGLE_SHEETS_WORKSHEET_NAME=Registros
   GOOGLE_DRIVE_FOLDER_ID=tu_folder_id
   TIMEZONE=America/Lima
   ```

#### 6. **Instalar Dependencias** üì¶

```bash
pip install -r requirements.txt
```

#### 7. **Probar el Bot** üöÄ

1. **Ejecutar con verificaci√≥n**:
   ```bash
   python start_bot.py
   ```

2. **Si todo est√° bien configurado, ver√°s**:
   ```
   üè® Bot de Registro de Clientes - Hotel
   ==================================================
   
   üîç Verificando configuraci√≥n...
   ‚úÖ Todas las dependencias est√°n instaladas
   ‚úÖ Variables de entorno configuradas
   ‚úÖ Archivo de credenciales encontrado
   ‚úÖ 1 usuario(s) autorizado(s)
   ‚úÖ Configuraci√≥n verificada exitosamente
   üöÄ Iniciando bot...
   ```

#### 8. **Pruebas en Telegram** üì±

1. **Iniciar conversaci√≥n**:
   - Buscar tu bot en Telegram
   - Enviar `/start`
   - Deber√≠as ver el mensaje de bienvenida

2. **Probar comandos**:
   - `/nuevo` - Iniciar registro
   - `/resumen` - Ver resumen del d√≠a
   - `/habitaciones` - Ver disponibilidad
   - `/ayuda` - Ver ayuda

3. **Probar flujo completo**:
   - Enviar `/nuevo`
   - Enviar una foto de DNI (puedes usar una imagen de prueba)
   - Completar el formulario paso a paso
   - Confirmar el registro

#### 9. **Verificar Resultados** ‚úÖ

1. **En Google Sheets**:
   - Revisar que se cre√≥ una fila con los datos
   - Verificar que todos los campos est√©n llenos

2. **En Google Drive**:
   - Revisar que se subi√≥ la foto del DNI
   - Verificar que el nombre incluya timestamp

3. **En Telegram**:
   - Probar `/resumen` para ver el registro
   - Probar `/habitaciones` para ver disponibilidad

#### 10. **Soluci√≥n de Problemas** üîß

**Si el bot no responde**:
- Verificar que el token sea correcto
- Revisar que tu chat_id est√© en AUTHORIZED_USERS

**Si hay error de OCR**:
- Verificar que Google Cloud Vision API est√© habilitada
- Revisar que las credenciales sean correctas

**Si no guarda en Sheets**:
- Verificar que la hoja est√© compartida con la cuenta de servicio
- Revisar que el ID de la hoja sea correcto

**Si no guarda en Drive**:
- Verificar que la carpeta est√© compartida
- Revisar que el ID de la carpeta sea correcto

### Ejemplo de Foto de DNI para Pruebas üì∏

Puedes usar cualquier imagen clara de un DNI para probar. El bot intentar√° extraer:
- Nombre
- N√∫mero de DNI
- Fecha de nacimiento
- Nacionalidad

### Resultado Esperado üéØ

Despu√©s de un registro exitoso, ver√°s:
- Una fila nueva en Google Sheets con todos los datos
- Una foto guardada en Google Drive
- Un mensaje de confirmaci√≥n en Telegram

## üìä Funcionalidades

### OCR de DNI

El bot puede extraer:
- Nombre completo
- N√∫mero de DNI
- Fecha de nacimiento
- Nacionalidad (Peruana, Venezolana, Colombiana, Ecuatoriana)

### Gesti√≥n de habitaciones

- Visualizaci√≥n de disponibilidad en tiempo real
- Habitaciones del 1 al 10 (configurable)
- Opci√≥n de habitaci√≥n personalizada

### Reportes

- Resumen diario con total de clientes e ingresos
- Historial de registros
- Disponibilidad de habitaciones

## üîí Seguridad

- **Acceso restringido**: Solo usuarios autorizados pueden usar el bot
- **Backup seguro**: Fotos almacenadas en Google Drive
- **Logs**: Registro de actividades para auditoria

## üì± Deployment

### Heroku

1. Crea una app en Heroku
2. Configura las variables de entorno
3. Sube el archivo de credenciales
4. Deploy con Git

### Railway

1. Conecta tu repositorio
2. Configura las variables de entorno
3. Deploy autom√°tico

### VPS

1. Instala Python y dependencias
2. Configura el archivo `.env`
3. Ejecuta con `python hotel_bot.py`
4. Usa systemd para mantener el bot ejecut√°ndose

## üìù Logs

El bot genera logs detallados en:
- Consola durante desarrollo
- Archivos de log en producci√≥n

## üîß Personalizaci√≥n

### Modificar opciones

En `config.py` puedes cambiar:
- Opciones de duraci√≥n
- Precios predefinidos
- Formas de pago
- N√∫mero de habitaciones

### Agregar funcionalidades

El bot est√° dise√±ado para ser extensible. Puedes agregar:
- Nuevos comandos
- Integraci√≥n con otras APIs
- Notificaciones autom√°ticas
- Reportes avanzados

## üêõ Soluci√≥n de problemas

### Bot no responde
- Verifica el token del bot
- Revisa que el bot est√© agregado a los chats

### Error de OCR
- Verifica las credenciales de Google Cloud
- Aseg√∫rate de que la API est√© habilitada

### Error de Google Sheets
- Verifica permisos de la hoja
- Revisa el ID de la hoja de c√°lculo

### Error de Google Drive
- Verifica permisos de la carpeta
- Revisa el ID de la carpeta

## üìû Soporte

Para soporte t√©cnico:
1. Revisa los logs del bot
2. Verifica la configuraci√≥n
3. Consulta la documentaci√≥n de APIs

## üèóÔ∏è Arquitectura

```
HotelBot/
‚îú‚îÄ‚îÄ hotel_bot.py           # Bot principal
‚îú‚îÄ‚îÄ config.py              # Configuraci√≥n
‚îú‚îÄ‚îÄ requirements.txt       # Dependencias
‚îú‚îÄ‚îÄ config_example.env     # Ejemplo de configuraci√≥n
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ ocr_processor.py   # Procesamiento OCR
‚îÇ   ‚îú‚îÄ‚îÄ sheets_manager.py  # Gesti√≥n Google Sheets
‚îÇ   ‚îî‚îÄ‚îÄ drive_manager.py   # Gesti√≥n Google Drive
‚îî‚îÄ‚îÄ credentials/
    ‚îî‚îÄ‚îÄ hotel-bot-credentials.json  # Credenciales Google
```

## üìÑ Licencia

Este proyecto est√° bajo la licencia MIT. Ver archivo LICENSE para m√°s detalles.

## ü§ù Contribuciones

Las contribuciones son bienvenidas. Por favor:
1. Fork el proyecto
2. Crea una rama para tu feature
3. Commit tus cambios
4. Push a la rama
5. Abre un Pull Request

## üìà Roadmap

- [ ] Interfaz web para administraci√≥n
- [ ] Integraci√≥n con WhatsApp
- [ ] Notificaciones autom√°ticas
- [ ] Reportes avanzados
- [ ] App m√≥vil
- [ ] Integraci√≥n con POS

---

Desarrollado con ‚ù§Ô∏è para hoteles modernos 